<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Event Carousel</title>
  <style>
    @font-face {
      font-family: "Noto Sans Ambassadori";
      font-style: normal;
      font-display: swap;
      src: url(https://usernamenotavailable12.github.io/Font-Repository/NotoSansAmbassadori-Regular.ttf);
    }

    body {
      margin: 0;
    }

    .card-block-container {
      display: flex;
      height: 76%;
    }

    .card-f-block,
    .card-s-block,
    .card-th-block {
      width: 100%;
      position: relative;
      transform: translateY(-15px);
    }

    .card-f-block h3,
    .card-th-block h3 {
      margin: 0;
      color: #FFF;
      font-family: 'Noto Sans Ambassadori';
      font-size: 10px;
      font-style: normal;
      font-weight: 500;
      line-height: 20px;
      position: absolute;
      top: 15px;
      white-space: nowrap;
      max-width: 100px;
      overflow: hidden;
      text-overflow: ellipsis;
      display: flex;
      flex-direction: column;
      justify-content: center;
    }

    .card-f-block h3 img,
    .card-th-block h3 img {
      margin: auto;
    }

    .card-f-block h3 {
      margin-left: 50%;
      transform: translateX(-50%);
    }

    .card-th-block h3 {
      margin-right: 50%;
      transform: translateX(50%);
    }

    .card-score-text {
      color: #F133FA;
      font-family: 'Noto Sans Ambassadori';
      font-size: 12px;
      font-style: normal;
      font-weight: 500;
      line-height: 20px;
      position: absolute;
      margin: 0 0 0 50%;
      bottom: 12px;
      transform: translateX(-50%) translateY(20px);
    }

    .card-name-block p {
      color: #FFF;
      font-family: 'Noto Sans Ambassadori';
      font-size: 12px;
      font-style: normal;
      font-weight: 500;
      line-height: 20px;
      opacity: 0.6;
      margin: 0;
      margin-left: 50%;
      transform: translateX(-50%);
      white-space: nowrap;
      position: absolute;
      top: 22px;
    }

    .card-date-text {
      margin: 0;
      text-align: center;
      color: #FFF;
      font-family: 'Noto Sans Ambassadori';
      font-size: 12px;
      font-style: normal;
      font-weight: 500;
      line-height: 20px;
    }

    .card-f-block h3 {
      left: 0;
    }

    .card-th-block h3 {
      right: 0;
    }

    .carousel-wrapper {
      position: relative;
      width: 100%;
      height: 320px;
    }

    .carousel-container {
      align-self: stretch;
      background: url("https://www.ambassadoribet.com/_internal/ts-images/5da2b4d5-59f6-412a-82c3-f6a272b532be/dev/81558d7e-f4a1-4117-93e8-20a501dda763/d56ebf81b0a24144dab8dfa196fed1c5d65b10a2.png?auto=format%2Ccompress");
      background-repeat: no-repeat;
      background-position: center;
      background-size: cover;
      border-radius: 0px;
      position: relative;
      width: 100%;
      height: 100%;
      overflow-x: auto;
      scrollbar-width: none;
      overflow-y: hidden;
    }

    .carousel-container::-webkit-scrollbar {
      display: none;
    }

    .carousel-row {
      display: flex;
      flex-direction: column;
      gap: 5px;
      padding: 20px;
      padding-right: 0;
      width: max-content;
    }

    .carousel-track {
      display: flex;
      position: relative;
      user-select: none;
      gap: 12px;
    }

    .carousel-track .event-card:last-of-type {
      margin-right: 0px;
    }

    .carousel-track:first-child .event-card {
      margin-left: 0px;
    }

    .error-message {
      color: #dc2626;
      margin-left: auto;
      margin-right: auto;
      max-width: 80rem;
      padding-bottom: 1.5rem;
      padding-top: 1rem;
      text-align: center;
    }

    .event-card {
      backdrop-filter: blur(30px);
      background: rgba(255, 255, 255, 0.02);
      background-size: cover;
      background-position: center;
      border-radius: 12px;
      box-shadow: 2px 2px 4px 2px rgba(0, 0, 0, 0.25);
      box-sizing: border-box;
      cursor: pointer;
      flex-shrink: 0;
      height: 137px;
      padding: 1.3rem;
      transition: box-shadow 0.2s ease;
      width: 286px;
      position: relative;
      z-index: 0;
    }

    .event-card:hover {
      box-shadow: 0 10px 15px rgba(0, 0, 0, 0.1);
    }

    .event-date {
      color: #4b5563;
      font-size: 0.275rem;
    }

    .event-title {
      color: #1f2937;
      font-size: 0.425rem;
      font-weight: 600;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .no-events-message {
      color: #4b5563;
      margin-left: auto;
      margin-right: auto;
      max-width: 80rem;
      padding-bottom: 1.5rem;
      padding-top: 1.5rem;
      text-align: center;
    }

    .odd-item {
      align-items: center;
      background: #3F0D64;
      border-radius: 15px;
      color: #FFF;
      display: flex;
      font-family: 'Noto Sans Ambassadori';
      font-size: 16px;
      font-style: normal;
      font-weight: 500;
      justify-content: space-between;
      line-height: 15px;
      padding: 10px 12px;
      width: 100%;
    }

    .odd-item p {
      margin: 0;
    }

    .odds-row {
      display: flex;
      gap: 12px;
      justify-content: space-between;
    }

    #app-container {
      background-color: transparent;
      height: 320px;
    }

    .competitor-logo {
      width: 34px;
      height: 34px;
      margin-right: 8px;
      vertical-align: middle;
      display: inline-block;
    }

    .scroll-button {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      width: 1.8rem;
      height: 1.8rem;
      background: #cf167d;
      backdrop-filter: blur(10px);
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 10;
      transition: background 0.3s ease;
    }

    .scroll-button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      opacity: .5;
    }

    .scroll-left {
      left: 10px;
    }

    .scroll-right {
      right: 10px;
    }

    .scroll-button svg {
      width: 20px;
      height: 20px;
      fill: #FFF;

      path {
        scale: 1.5;
        transform: translateX(-3.8px) translateY(-3.8px);
      }
    }

    .carousel-wrapper {
      .scroll-button {
        opacity: 0;
        transition: all 0.3s ease;
      }
    }

    .carousel-wrapper:hover {
      .scroll-button {
        opacity: 1;
      }
    }

    .carousel-wrapper:before {
      content: "";
      background-image: linear-gradient(to right, transparent, rgba(0, 0, 0, 0.5));
      display: inline-block;
      width: 50px;
      height: 320px;
      position: absolute;
      border-top-right-radius: 10px;
      border-bottom-right-radius: 10px;
      right: 0;
      top: 0;
      z-index: 2;
      pointer-events: none;
    }

    .carousel-wrapper:after {
      content: "";
      background-image: linear-gradient(to left, transparent, rgba(0, 0, 0, 0.5));
      display: inline-block;
      width: 50px;
      height: 320px;
      position: absolute;
      border-top-right-radius: 10px;
      border-bottom-right-radius: 10px;
      left: 0;
      top: 0;
      z-index: 2;
      pointer-events: none;
    }
  </style>
</head>

<body>
  <div id="root"></div>
  <script src="https://cdn.jsdelivr.net/npm/react@18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/react-dom@18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@babel/standalone@7.22.9/babel.min.js"></script>
  <script type="text/babel">
    const { useState, useEffect, useRef } = React;

    const formatDate = (dateString) => {
      const date = new Date(dateString);
      const month = date.getMonth() + 1;
      const day = date.getDate();
      const hour = date.getHours();
      const minute = date.getMinutes().toString().padStart(2, '0');
      return `${month}.${day}-${hour}:${minute}`;
    };

    const getOddsForMarket = (marketId, markets, odds) => {
      const market = markets.find((m) => m.id === marketId);
      if (!market) return [];
      return market.oddIds.map((oddId) => odds.find((o) => o.id === oddId)).filter(Boolean);
    };

    const backgroundImages = {
      default: 'https://www.ambassadoribet.com/_internal/ts-images/5da2b4d5-59f6-412a-82c3-f6a272b532be/dev/f7535abc-73c7-40fd-bca0-6b547f3c57da/b64a4b9fc2a399111df3fe2a92b88a4d8dc52132.png?auto=format%2Ccompress',
      sports: {
        '67': 'https://www.ambassadoribet.com/_internal/ts-images/5da2b4d5-59f6-412a-82c3-f6a272b532be/dev/2cd76afe-7518-4a3b-b450-423054f0264b/b3f45ba2a9849b8abb9c41ad6f2eea893c59f37e.png?auto=format%2Ccompress',
        '66': 'https://www.ambassadoribet.com/_internal/ts-images/5da2b4d5-59f6-412a-82c3-f6a272b532be/dev/f7535abc-73c7-40fd-bca0-6b547f3c57da/b64a4b9fc2a399111df3fe2a92b88a4d8dc52132.png?auto=format%2Ccompress',
        '84': 'https://www.ambassadoribet.com/_internal/ts-images/5da2b4d5-59f6-412a-82c3-f6a272b532be/dev/22c4b458-ce8a-4c52-8486-259953496316/sdddddd-01.png?auto=format%2Ccompress',
      },
      champs: {
        'premier-league': 'https://www.ambassadoribet.com/_internal/ts-images/5da2b4d5-59f6-412a-82c3-f6a272b532be/dev/22c4b458-ce8a-4c52-8486-259953496316/sdddddd-01.png?auto=format%2Ccompress',
      },
    };

    const getBackgroundImage = (sportId, champId) => {
      if (champId && backgroundImages.champs[champId]) {
        return backgroundImages.champs[champId];
      }
      if (sportId && backgroundImages.sports[sportId]) {
        return backgroundImages.sports[sportId];
      }
      return backgroundImages.default;
    };

    const EventCard = ({ event, markets, odds, competitors, champs, categories }) => {
      const oddsData = getOddsForMarket(event.marketIds[0], markets, odds);
      const [isMobile, setIsMobile] = useState(window.innerWidth <= 768);
      const backgroundImage = getBackgroundImage(event.sportId, event.champId);

      useEffect(() => {
        const handleResize = () => {
          setIsMobile(window.innerWidth <= 768);
        };
        window.addEventListener('resize', handleResize);
        return () => window.removeEventListener('resize', handleResize);
      }, []);

      const handleClick = () => {
        const url = `/sportsbook/event/${event.id}`;
        window.parent.postMessage({ type: 'TMA_HREF', payload: url }, '*');
      };

      return (
        <div className="event-card" onClick={handleClick} style={{ backgroundImage: `url(${backgroundImage})` }}>
          <div className="card-block-container">
            <div className="card-f-block">
              <h3 title={competitors.find((c) => c.id === event.competitorIds[0])?.name || ''}>
                <img
                  src={`https://sb2jerseys-altenar2.biahosted.com/63/l/${event.competitorIds[0]}`}
                  alt={`${competitors.find((c) => c.id === event.competitorIds[0])?.name || ''} logo`}
                  className="competitor-logo"
                  onError={(e) => (e.target.style.display = 'none')}
                />
                {competitors.find((c) => c.id === event.competitorIds[0])?.name || ''}
              </h3>
            </div>
            <div className="card-s-block">
              <p className="card-date-text">{formatDate(event.startDate)}</p>
              <span className="card-name-block">
                <p>
                  {categories.find((c) => c.id === event.catId)?.name.slice(0, 5) || ''},{' '}
                  {(champs.find((c) => c.id === event.champId)?.name.slice(0, 5) || '') + '.'}
                </p>
              </span>
              <p className="card-score-text">+{event?.sc || ''}</p>
            </div>
            <div className="card-th-block">
              <h3 title={competitors.find((c) => c.id === event.competitorIds[1])?.name || ''}>
                <img
                  src={`https://sb2jerseys-altenar2.biahosted.com/63/l/${event.competitorIds[1]}`}
                  alt={`${competitors.find((c) => c.id === event.competitorIds[1])?.name || ''} logo`}
                  className="competitor-logo"
                  onError={(e) => (e.target.style.display = 'none')}
                />
                {competitors.find((c) => c.id === event.competitorIds[1])?.name || ''}
              </h3>
            </div>
          </div>
          <div className="odds-container">
            <div className="odds-row">
              {oddsData.map((odd) => (
                <span key={odd.id} className="odd-item">
                  <p>{odd.name}</p>
                  <p>{(Math.round(odd.price * 100) / 100).toFixed(2)}</p>
                </span>
              ))}
            </div>
          </div>
        </div>
      );
    };

    const Carousel = ({ data, error }) => {
      const containerRef = useRef(null);
      const isDragging = useRef(false);
      const startX = useRef(0);
      const scrollLeftStart = useRef(0);
      const [canScrollLeft, setCanScrollLeft] = useState(false);
      const [canScrollRight, setCanScrollRight] = useState(true);

      const checkScroll = () => {
        if (containerRef.current) {
          const { scrollLeft, scrollWidth, clientWidth } = containerRef.current;
          setCanScrollLeft(scrollLeft > 0);
          setCanScrollRight(scrollLeft < scrollWidth - clientWidth - 1);
        }
      };

      useEffect(() => {
        const container = containerRef.current;
        if (container) {
          container.addEventListener('scroll', checkScroll);
          checkScroll();
        }
        return () => {
          if (container) container.removeEventListener('scroll', checkScroll);
        };
      }, [data]);

      const handleStart = (clientX) => {
        if (containerRef.current) {
          isDragging.current = true;
          startX.current = clientX;
          scrollLeftStart.current = containerRef.current.scrollLeft;
          containerRef.current.style.cursor = 'grabbing';
          containerRef.current.style.scrollBehavior = 'auto';
          containerRef.current.style.scrollSnapType = 'none';
        }
      };

      const handleMove = (clientX) => {
        if (!isDragging.current || !containerRef.current) return;
        const walk = clientX - startX.current;
        containerRef.current.scrollLeft = scrollLeftStart.current - walk;
      };

      const handleEnd = () => {
        if (containerRef.current) {
          isDragging.current = false;
          containerRef.current.style.cursor = 'grab';
          containerRef.current.style.scrollBehavior = 'smooth';
          containerRef.current.style.scrollSnapType = '';
        }
        checkScroll();
      };

      const handleMouseDown = (e) => {
        e.preventDefault();
        handleStart(e.clientX);
      };

      const handleMouseMove = (e) => {
        if (isDragging.current) e.preventDefault();
        handleMove(e.clientX);
      };

      const handleTouchStart = (e) => {
        handleStart(e.touches[0].clientX);
      };

      const handleTouchMove = (e) => {
        if (isDragging.current) e.preventDefault();
        handleMove(e.touches[0].clientX);
      };

      const scrollLeft = () => {
        if (containerRef.current) {
          const cardWidth = 326 + 12; // Card width + gap
          containerRef.current.scrollBy({ left: -cardWidth, behavior: 'smooth' });
        }
      };

      const scrollRight = () => {
        if (containerRef.current) {
          const cardWidth = 326 + 12; // Card width + gap
          containerRef.current.scrollBy({ left: cardWidth, behavior: 'smooth' });
        }
      };

      if (error) {
        return (
          <div className="error-message">
            <p>Error fetching events: {error}</p>
          </div>
        );
      }

      if (!data || !data.events || data.events.length === 0) {
        return (
          <div className="no-events-message">
            <p>No events available</p>
          </div>
        );
      }

      const halfLength = Math.ceil(data.events.length / 2);
      const topEvents = data.events.slice(0, halfLength);
      const bottomEvents = data.events.slice(halfLength);

      return (
        <div className="carousel-wrapper">
          <button
            className="scroll-button scroll-left"
            onClick={scrollLeft}
            disabled={!canScrollLeft}
            aria-label="Scroll left"
          >
            <svg viewBox="0 0 24 24">
              <path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z" />
            </svg>
          </button>
          <div
            ref={containerRef}
            className="carousel-container"
            onMouseDown={handleMouseDown}
            onMouseMove={handleMouseMove}
            onMouseUp={handleEnd}
            onMouseLeave={handleEnd}
            onTouchStart={handleTouchStart}
            onTouchMove={handleTouchMove}
            onTouchEnd={handleEnd}
            style={{ cursor: 'grab' }}
          >
            <div className="carousel-row">
              <div className="carousel-track">
                {topEvents.map((event) => (
                  <EventCard
                    key={event.id}
                    event={event}
                    markets={data.markets}
                    odds={data.odds}
                    competitors={data.competitors}
                    champs={data.champs}
                    categories={data.categories}
                  />
                ))}
              </div>
              <div className="carousel-track">
                {bottomEvents.map((event) => (
                  <EventCard
                    key={event.id}
                    event={event}
                    markets={data.markets}
                    odds={data.odds}
                    competitors={data.competitors}
                    champs={data.champs}
                    categories={data.categories}
                  />
                ))}
              </div>
            </div>
          </div>
          <button
            className="scroll-button scroll-right"
            onClick={scrollRight}
            disabled={!canScrollRight}
            aria-label="Scroll right"
          >
            <svg viewBox="0 0 24 24">
              <path d="M8.59 16.59L10 18l6-6-6-6-1.41 1.41L13.17 12z" />
            </svg>
          </button>
        </div>
      );
    };

    const App = () => {
      const [data, setData] = useState(null);
      const [error, setError] = useState(null);

      useEffect(() => {
        const fetchData = async () => {
          try {
            const urlParams = new URLSearchParams(window.location.search);
            const culture = urlParams.get('culture') || 'ka-GE';
            const response = await fetch(
              `https://sb2frontend-altenar2.biahosted.com/api/widget/GetTopEvents?culture=${culture}&integration=ambassadoribet`,
              {
                method: 'GET',
                headers: { Accept: 'application/json' },
              }
            );
            if (!response.ok) throw new Error(`HTTP error! Status: ${response.status}`);
            const result = await response.json();
            setData(result);
          } catch (err) {
            setError(err.message);
          }
        };
        fetchData();
      }, []);

      return (
        <div id="app-container">
          <Carousel data={data} error={error} />
        </div>
      );
    };

    ReactDOM.render(<App />, document.getElementById('root'));
  </script>
</body>

</html>
